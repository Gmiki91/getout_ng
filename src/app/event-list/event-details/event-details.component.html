<div (click)="onCloseDialog()" class="backdrop"></div>
<dialog open class="event-dialog">
  <mat-card class="event-card">
    <mat-card-header>
      <mat-card-title>{{ event().title }}</mat-card-title>
      <mat-card-subtitle>{{
        event().time | date : "medium"
      }}</mat-card-subtitle>
    </mat-card-header>

    <mat-card-content>
      <div class="event-details">
        <div><strong>Location:</strong> {{ event().location }}</div>
        <div>
          <strong>Participants:</strong> {{ event().participants.length }} /
          {{ event().max }}
        </div>
        @if(event().info){<div><strong>Info:</strong> {{ event().info }}</div>}
      </div>

      <mat-divider></mat-divider>

      <mat-form-field appearance="outline" class="comment-box">
        <textarea
          matInput
          placeholder="Add a comment"
          #komment
          ngModel
          cdkAutosizeMinRows="5"
        ></textarea>
      </mat-form-field>
      <button mat-raised-button color="primary" (click)="onAddKomment()">
        Add Comment
      </button>

      <mat-list custom-scroll class="comment-list">
        @for(komment of komments(); track komment.id){
        <mat-list-item class="comment-item">
          <strong>{{ komment.userName }}</strong>
          <br />
          <i>{{ komment.timestamp | timeText : "since" }}</i>
          <p class="comment-text">{{ komment.text }}</p>
        </mat-list-item>
        }
      </mat-list>

      <mat-divider></mat-divider>
    </mat-card-content>

    <mat-card-actions class="event-actions">
      @if(joined()){
      <button mat-stroked-button color="warn" (click)="onLeave()">Leave</button>
      }@else{
      <button mat-raised-button color="primary" (click)="onJoin()">Join</button>
      } @if(userId === event().ownerId){
      <button mat-raised-button color="warn" (click)="onDelete()">
        Delete
      </button>
      }
    </mat-card-actions>
  </mat-card>
</dialog>
